<html>
<head>
    <title>Twitts Viz with socket.io and node.js</title>
    <meta charset='utf-8' />
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.18.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.18.0/mapbox-gl.css' rel='stylesheet' />

    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

    <style>
        .items-collection label.btn-default.active {
            background-color: #007ba7;
            color: #FFF;
        }
        
        .items-collection1 label.btn-default {
            width: 10%;
            border: 1px solid #305891;
            margin: 0;
            padding-right: 0px;
            border-radius: 17px;
            color: #305891;
            opacity: 0.5
        }
        
        .items-collection label .itemcontent {
            width: 100%;
        }
        
        .items-collection .btn-group {
            width: 100%;
            padding-left: 45px
        }
        
        #tweetsbox {
            position: absolute;
            top: 0;
            background-color: rgba(52, 152, 219, 0.2);
            color: #FFF;
            height: 100px;
            width: 500px;
            margin-left: 200px;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 79%;
        }

        button.btn-default:focus{
            border: none;
            color: #c7b938;
            background-color: rgba(52, 152, 219, 0);
            outline: 0;
        }
        button.btn-default:hover{
            border: none;
            color: #c7b938;
            background-color: rgba(52, 152, 219, 0);
        
        }

        button.btn-default {
            background-color: rgba(52, 152, 219, 0);
            border: none;
            color: #FFF;
            padding-left: 20px;
        }
        #hash:active {
            border: none;
          color: #c7b938;
            background-color: rgba(52, 152, 219, 0);
            outline: 0;
        }
        #mention:active {
            border: none;
          color: #c7b938;
            background-color: rgba(52, 152, 219, 0);
            outline: 0;
        }
        #refresh{
            color: #FFF;
            margin:20px;
        }

        li {
            border-bottom: 1px solid #ccc;
        }
    </style>
</head>

<body>

    <div id='map'></div>
    <i id="refresh" class="fa fa-refresh fa-2x" aria-hidden="true" style="position:absolute;"></i>

	<div style="position: absolute; right: 0; width: 21%;">
		<div id="lists">
		<div class=" panel panel-default">
			<div class="panel-heading" style="background-color:#5592aa">
				<div class="row">
                    <center>
					    <div class="btn-group" id="title">
						    <button class="btn btn-default" id="hash" onclick="updateHash()">Hashtag</button>
						    <button class="btn btn-default" id="mention" onclick="updateMention()">Mentioned</button>
					    </div>
                    </center>
				</div>
			</div>
	   
			<div class="panel-body">
				<ul class="list-group" id="ranking">
					<ol id="hashTopList" class="topList"></ol>
					<ol id="mentionTopList" class="topList"></ol>
				</ul>
			</div>
		</div>
	</div>
	</div>
	
	<div class='row'>
		<div class="alert alert-info" id="tweetsbox"><span>Real-Time Tweets</span></div>
	</div>
	
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="/func.js"></script>
	<script>

		jQuery(function ($) {
            //Global variables
			var socket = io.connect();
			var $tweetsbox = $('#tweetsbox');
			var mapLoaded = false;
			
			$(document).ready(function () {
				mapboxgl.accessToken = 'pk.eyJ1Ijoid2Vpc2hpIiwiYSI6ImNpbmc5cHV4bzFnOHJ1Zmx3ZGxpaGU0aGIifQ.L20RZ709ePgurmOeOYPwXg';
				map = new mapboxgl.Map({
					container: 'map'
					, style: 'mapbox://styles/mapbox/dark-v8'
					, center: [-73.961425, 40.786338]
					, zoom: 11.7
				});
				//here you try to ask the user position then setView to map
				map.on('style.load', function () {
					registerTempLayer("marker_temp", "lightblue");
					registerLayer("marker_0", "#c84337", false, 0.9, 6);
					registerLayer("marker_1", "#ca7f35", false, 0.9, 4);
					registerLayer("marker_2", "#d9be26", false, 0.9, 3);
					registerLayer("marker_3", "#a1be41", false, 0.8, 3);
					registerLayer("marker_4", "#3cc382", false, 0.8, 3);
					registerLayer("marker_5", "#3f88bf", false, 0.8, 3);
					registerLayer("marker_6", "#3f88bf", false, 0.6, 3);
					registerLayer("marker_7", "#3f88bf", false, 0.4, 3);
					registerLayer("marker_8", "#3f88bf", false, 0.2, 3);
					registerLayer("marker_9", "#3f88bf", false, 0.1, 3);
					
					registerLayer("mention_0", "#c84337", false, 0.9, 6);
					registerLayer("mention_1", "#ca7f35", false, 0.9, 4);
					registerLayer("mention_2", "#d9be26", false, 0.9, 4);
					registerLayer("mention_3", "#a1be41", false, 0.8, 3);
					registerLayer("mention_4", "#3cc382", false, 0.8, 3);
					registerLayer("mention_5", "#3f88bf", false, 0.8, 3);
					registerLayer("mention_6", "#3f88bf", false, 0.6, 3);
					registerLayer("mention_7", "#3f88bf", false, 0.4, 3);
					registerLayer("mention_8", "#3f88bf", false, 0.2, 3);
					registerLayer("mention_9", "#3f88bf", false, 0.1, 3);
					//registerLayer("restword", "white", false, 0.1, 3);
					mapLoaded = true;
                    refreshPastData();
				});
			});
			/*
			$("#message1 label.btn").on("click", function () {
				if ($(this).attr('id') == 1) {
					map.setLayoutProperty("marker_all", 'visibility', 'none');
				}
				if ($(this).attr('id') == 2) {
					map.setLayoutProperty("marker_all", 'visibility', 'visible');
				}
			});
			*/
			$("#title button.btn").on("click", function () {
                if ($(this).attr('id') == 'mention') {
                    for (var i = 0; i < 10; i++) {
                        var layer = "marker_" + i;
                        map.setLayoutProperty(layer, 'visibility', 'none');
                    }
                    for (var i = 0; i < 10; i++) {
                        var layer = "mention_" + i;
                        map.setLayoutProperty(layer, 'visibility', 'visible');
                    }
                }
                if ($(this).attr('id') == 'hash') {
                    console.log($(this).attr('id'));
 
                     for (var i = 0; i < 10; i++) {
                        var layer = "mention_" + i;
                        map.setLayoutProperty(layer, 'visibility', 'none');
                    }
                    for (var i = 0; i < 10; i++) {
                        var layer = "marker_" + i;
                        map.setLayoutProperty(layer, 'visibility', 'visible');
                    }
                }
            });
			
		    $("#refresh").on("click", function (){
			  for (var i = 0; i < 10; i++) {
					var layer = "marker_" + i;
					map.setLayoutProperty(layer, 'visibility', 'visible');
				}
				for (var i = 0; i < 10; i++) {
					var layer = "mention_" + i;
					map.setLayoutProperty(layer, 'visibility', 'visible');
				}
            });
			 
			function refreshPastData() {
				socket.emit('past data');
			}
			var refreshId = setInterval(refreshPastData, 60000);

			socket.on('past data', function (data) {
				procPastData(data);
				updateHash();
				serveData();
			});

			function displayMsg(data) {
				$tweetsbox.html('<span class="msg"><b>' + data.user + ': </b>' + data.text + ' ' + "</span><br/>");
			}
			
			socket.on('new tweets', function (data) {
				if (mapLoaded) {
					displayMsg(data);
					showPoint(data.point);
				}
			});
		});
	</script>
</body>

</html>
